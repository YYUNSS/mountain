<!-- <!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>게시판 조회</title>
  <script>
    window.totalCnt = [[${totalCnt}]];
    window.cpgs = [[${cpgs}]];
    window.cp = [[${cp}]];

    //페이징 객체 생성
    const pagination = new Pagination(10, 10); // 한페이지에 보여줄 레코드건수,한페이지에 보여줄 페이지수
    //총 레코드 건수
    const totalCnt = window.totalCnt;
    const cpgs = window.cpgs;
    const cp = window.cp;

    pagination.setCurrentPageGroupStart(cpgs); //페이지 그룹 시작번호
    pagination.setCurrentPage(cp); //현재 페이지
    pagination.setTotalRecords(totalCnt); //총레코드 건수
    pagination.displayPagination(nextPage);

    function nextPage(){
      const reqPage = pagination.currentPage;   //요청 페이지
      const reqCnt = pagination.recordsPerPage; //페이지당 레코드수

      const cpgs = pagination.currentPageGroupStart; //페이지 그룹 시작번호
      const cp = pagination.currentPage;            //현재 페이지

      location.href = `/products?reqPage=${reqPage}&reqCnt=${reqCnt}&cpgs=${cpgs}&cp=${cp}`;
    }

      const $addBtn = document.getElementById('addBtn');
      $addBtn.addEventListener('click', evt=>{
        location.href = '/products/add';                // GET   http://localhost:9080/products/add
      });

      const $rows = document.getElementById('rows');
      $rows.addEventListener('click',evt=>{
        //1) input요소 이면서 checkbox는 제외
        if(evt.target.tagName === 'INPUT' &&  evt.target.getAttribute('type') == 'checkbox') {
          return;
        };
        //2) td요소중  checkbox있는 td는 제외
        if(evt.target.tagName == 'TD' && evt.target.classList.contains('chk')){
          return;
        }
        const $row = evt.target.closest('.row');
        const productId = $row.dataset.productId;
        location.href = `/products/${productId}/detail`;    // GET http://localhost:9080/상품번호/detail
      });

      //삭제
      const frm = document.getElementById('frm');
      frm.addEventListener('submit', evt=>{
        evt.preventDefault();  //기본 이벤트(submit) 중지
        if(!window.confirm('삭제하시겠습니까?')) return;
        evt.target.submit();
      });

      //전체선택
      //일부 체크박스가 체크되어있다면 언체크, 그렇지 않으면 모든 체크박스를 체크
      const $selectAll = document.getElementById('selectAll');
      $selectAll.addEventListener('click',evt=>{
        //Array.from(iteral) : iteral객체를 배열로 변환
        const $inputs = Array.from(document.querySelectorAll('#rows input[type=checkbox]'));
        const isSomeChecked = $inputs.some(input=>input.checked == true)
        if(isSomeChecked) {
          $inputs.forEach(input=>input.checked = false);  // 일부 체크박스가 uncheck면 모든 체크박스를 unchecked 변경
        }else{
          $inputs.forEach(input=>input.checked = true);  // 모든 체크박스를 checked로 변경
        }
      });
   function handleSearch(event) {
     const searchType = document.querySelector('select[name="searchType"]').value;
     const keyword = document.querySelector('input[name="keyword"]').value; // 키워드 가져오기
     if (keyword.trim() === '') { // 키워드가 비어있으면
       event.preventDefault(); // 폼의 기본 제출을 막습니다.
       window.location.href = 'http://localhost:9090/manager/viewBbsAll'; // 전체 게시글 조회 페이지로 이동합니다.
     }
   }
  </script>
</head>
<body>
<h1>검색 결과</h1>
<form th:action="@{/manager/searchBbs}" method="get" onsubmit="handleSearch(event)">
  <select name="searchType">
    <option value="all" selected> 전체</option>
    <option value="title">제목</option>
    <option value="mntnName">산 이름</option>
    <option value="nickname">작성자</option>
  </select>
  <input type="text" name="keyword" placeholder="검색어" />
  <button type="submit">검색</button>
</form>
<form id="frm" action="manager/comBbs" method="POST">
  <div>
    <table>
      <thead>
      <tr>
        <th>선택</th>
        <th>닉네임</th>
        <th>제목</th>
        <th>내용</th>
        <th>조회수</th>
        <th>평점</th>
        <th>작성일</th>
        <th>수정일</th>
        <th>산 이름</th>
        <th>글 상태</th>
      </tr>
      </thead>
      <tbody class="rows">
      <tr class="row" th:each="bbs : ${list}">
        <td class="chk"><input type="checkbox" name="bbsIds" th:value="${bbs.bbsId}"/></td>
        <td th:text="${bbs.nickname}"></td>
        <td th:text="${bbs.title}"></td>
        <td th:text="${bbs.bcontent}"></td>
        <td th:text="${bbs.hit}"></td>
        <td th:text="${bbs.staring}"></td>
        <td th:text="${bbs.cdate}"></td>
        <td th:text="${bbs.udate}"></td>
        <td th:text="${bbs.mntnNm}"></td>
        <td th:text="${bbs.status}"></td>
      </tr>
      </tbody>
    </table>
    </div>
    <div>
      <button type="submit" id="delBtn">삭제</button>
    </div>
    </div>
</form>
<h3><a href="http://localhost:9090/manager/comBbs "> 신고글</a></h3>
<div id="pagination"></div>
</body>
</html> -->
<!-- --------------------------------------------------------------------- -->
<!-- <!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>게시판 조회</title>
  <script>
    // Thymeleaf로부터 totalCnt, cpgs, cp 값 받아오기
    window.totalCnt = /*[[${totalCnt}]]*/ 0;
    window.cpgs = /*[[${cpgs}]]*/ 0;
    window.cp = /*[[${cp}]]*/ 0;

    document.addEventListener("DOMContentLoaded", function() {
      // 페이징 객체 생성
      const pagination = new Pagination(10, 10); // 한 페이지에 보여줄 레코드 건수, 한 페이지에 보여줄 페이지 수

      const totalCnt = window.totalCnt;
      const cpgs = window.cpgs;
      const cp = window.cp;

      pagination.setCurrentPageGroupStart(cpgs); // 페이지 그룹 시작 번호
      pagination.setCurrentPage(cp); // 현재 페이지
      pagination.setTotalRecords(totalCnt); // 총 레코드 건수
      pagination.displayPagination(nextPage);

      function nextPage() {
        const reqPage = pagination.currentPage; // 요청 페이지
        const reqCnt = pagination.recordsPerPage; // 페이지당 레코드 수

        const cpgs = pagination.currentPageGroupStart; // 페이지 그룹 시작 번호
        const cp = pagination.currentPage; // 현재 페이지

        location.href = `/products?reqPage=${reqPage}&reqCnt=${reqCnt}&cpgs=${cpgs}&cp=${cp}`;
      }

      const $addBtn = document.getElementById('addBtn');
      if ($addBtn) {
        $addBtn.addEventListener('click', () => {
          location.href = '/products/add'; // GET http://localhost:9080/products/add
        });
      }

      const $rows = document.querySelector('.rows');
      if ($rows) {
        $rows.addEventListener('click', evt => {
          if (evt.target.tagName === 'INPUT' && evt.target.type === 'checkbox') return;
          if (evt.target.tagName === 'TD' && evt.target.classList.contains('chk')) return;

          const $row = evt.target.closest('.row');
          if ($row) {
            const productId = $row.dataset.productId;
            location.href = `/products/${productId}/detail`; // GET http://localhost:9080/상품번호/detail
          }
        });
      }

      const frm = document.getElementById('frm');
      if (frm) {
        frm.addEventListener('submit', evt => {
          evt.preventDefault();
          if (window.confirm('삭제하시겠습니까?')) {
            evt.target.submit();
          }
        });
      }

      const $selectAll = document.getElementById('selectAll');
      if ($selectAll) {
        $selectAll.addEventListener('click', () => {
          const $inputs = Array.from(document.querySelectorAll('#rows input[type=checkbox]'));
          const isSomeChecked = $inputs.some(input => input.checked);
          $inputs.forEach(input => input.checked = !isSomeChecked);
        });
      }
    });

    function handleSearch(event) {
      const searchType = document.querySelector('select[name="searchType"]').value;
      const keyword = document.querySelector('input[name="keyword"]').value.trim();
      if (keyword === '') {
        event.preventDefault();
        window.location.href = 'http://localhost:9090/manager/viewBbsAll';
      }
    }
  </script>
</head>
<body>
  <h1>검색 결과</h1>
  <form th:action="@{/manager/searchBbs}" method="get" onsubmit="handleSearch(event)">
    <select name="searchType">
      <option value="all" selected> 전체</option>
      <option value="title">제목</option>
      <option value="mntnName">산 이름</option>
      <option value="nickname">작성자</option>
    </select>
    <input type="text" name="keyword" placeholder="검색어" />
    <button type="submit">검색</button>
  </form>
  
  <form id="frm" th:action="@{/manager/comBbs}" method="POST">
    <div>
      <table>
        <thead>
          <tr>
            <th>선택</th>
            <th>닉네임</th>
            <th>제목</th>
            <th>내용</th>
            <th>조회수</th>
            <th>평점</th>
            <th>작성일</th>
            <th>수정일</th>
            <th>산 이름</th>
            <th>글 상태</th>
          </tr>
        </thead>
        <tbody id="rows" class="rows">
          <tr class="row" th:each="bbs : ${list}" th:data-product-id="${bbs.bbsId}">
            <td class="chk"><input type="checkbox" name="bbsIds" th:value="${bbs.bbsId}"/></td>
            <td th:text="${bbs.nickname}"></td>
            <td th:text="${bbs.title}"></td>
            <td th:text="${bbs.bcontent}"></td>
            <td th:text="${bbs.hit}"></td>
            <td th:text="${bbs.staring}"></td>
            <td th:text="${bbs.cdate}"></td>
            <td th:text="${bbs.udate}"></td>
            <td th:text="${bbs.mntnNm}"></td>
            <td th:text="${bbs.status}"></td>
          </tr>
        </tbody>
      </table>
    </div>
    <div>
      <button type="submit" id="delBtn">삭제</button>
    </div>
  </form>
  
  <h3><a href="http://localhost:9090/manager/comBbs">신고글</a></h3>
  <div class="pagination"></div>
</body>
</html> -->

<!-- ------------------------------------------------------->
<!--<!DOCTYPE html>-->
<!--<html xmlns:th="http://www.thymeleaf.org">-->
<!--<head>-->
<!--    <title>게시판 조회</title>-->
<!--    &lt;!&ndash; JavaScript 파일을 불러옵니다. &ndash;&gt;-->
<!--    <script type="module" src="/js/mountain_project/mReadBbs.js"></script>-->
<!--</head>-->
<!--<body>-->
<!--<h1>검색 결과</h1>-->
<!--<form th:action="@{/manager/searchBbs}" method="get" onsubmit="handleSearch(event)">-->
<!--    <select name="searchType">-->
<!--        <option value="all" selected> 전체</option>-->
<!--        <option value="title">제목</option>-->
<!--        <option value="mntnName">산 이름</option>-->
<!--        <option value="nickname">작성자</option>-->
<!--    </select>-->
<!--    <input type="text" name="keyword" placeholder="검색어" />-->
<!--    <button type="submit">검색</button>-->
<!--</form>-->

<!--<form id="frm" th:action="@{/manager/comBbs}" method="POST">-->
<!--    <div>-->
<!--        <table>-->
<!--            <thead>-->
<!--            <tr>-->
<!--                <th>선택</th>-->
<!--                <th>닉네임</th>-->
<!--                <th>제목</th>-->
<!--                <th>내용</th>-->
<!--                <th>조회수</th>-->
<!--                <th>평점</th>-->
<!--                <th>작성일</th>-->
<!--                <th>수정일</th>-->
<!--                <th>산 이름</th>-->
<!--                <th>글 상태</th>-->
<!--            </tr>-->
<!--            </thead>-->
<!--            <tbody id="rows" class="rows">-->
<!--            <tr class="row" th:each="bbs : ${list}" th:data-product-id="${bbs.bbsId}">-->
<!--                <td class="chk"><input type="checkbox" name="bbsIds" th:value="${bbs.bbsId}"/></td>-->
<!--                <td th:text="${bbs.nickname}"></td>-->
<!--                <td th:text="${bbs.title}"></td>-->
<!--                <td th:text="${bbs.bcontent}"></td>-->
<!--                <td th:text="${bbs.hit}"></td>-->
<!--                <td th:text="${bbs.staring}"></td>-->
<!--                <td th:text="${bbs.cdate}"></td>-->
<!--                <td th:text="${bbs.udate}"></td>-->
<!--                <td th:text="${bbs.mntnNm}"></td>-->
<!--                <td th:text="${bbs.status}"></td>-->
<!--            </tr>-->
<!--            </tbody>-->
<!--        </table>-->
<!--    </div>-->
<!--    <div>-->
<!--        <button type="submit" id="delBtn">삭제</button>-->
<!--    </div>-->
<!--</form>-->

<!--&lt;!&ndash; 페이지네이션을 표시할 요소 &ndash;&gt;-->
<!--<div id="pagination"></div>-->

<!--<h3><a href="http://localhost:9090/manager/comBbs">신고글</a></h3>-->
<!--</body>-->
<!--</html>-->

<!----------------------------------------------->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>게시판 조회</title>
    <script>
        // Pagination 클래스 정의
        class Pagination {
            constructor(recordsPerPage, pagesPerPage) {
                this.totalRecords = 0; // 총 레코드수
                this.recordsPerPage = recordsPerPage; // 페이지당 레코드수
                this.pagesPerPage = pagesPerPage; // 페이지당 페이지수
                this.currentPage = 1; // 현재 페이지
                this.currentPageGroupStart = 1; // 현재 페이지의 시작페이지
            }

            getTotalRecords() {
                return this.totalRecords;
            }

            getTotalPages() {
                return Math.ceil(this.totalRecords / this.recordsPerPage);
            }

            displayNavigation() {
                const totalPages = this.getTotalPages();
                let pageNavigation =
                    this.currentPageGroupStart > 1
                        ? '<button id="first">처음</button> <button id="prev">이전</button> '
                        : '';

                for (
                    let i = this.currentPageGroupStart;
                    i < this.currentPageGroupStart + this.pagesPerPage && i <= totalPages;
                    i++
                ) {
                    //현재 페이지인 경우
                    if (i === this.currentPage) {
                        pageNavigation += `<button class="active" id="page${i}">${i}</button> `;
                        //현재 페이지 아닌 경우
                    } else {
                        pageNavigation += `<button id="page${i}">${i}</button> `;
                    }
                }

                pageNavigation +=
                    this.currentPageGroupStart + this.pagesPerPage - 1 < totalPages
                        ? '<button id="next">다음</button> <button id="last">끝</button>'
                        : '';
                return pageNavigation;
            }

            setTotalRecords(totalRecords) {
                this.totalRecords = totalRecords;
            }

            setCurrentPage(pageNumber) {
                this.currentPage = pageNumber;
            }

            setCurrentPageGroupStart(cpgs) {
                this.currentPageGroupStart = cpgs;
            }

            setNextPageGroup() {
                this.currentPageGroupStart += this.pagesPerPage;
            }

            setPrevPageGroup() {
                this.currentPageGroupStart -= this.pagesPerPage;
                if (this.currentPageGroupStart < 1) {
                    this.currentPageGroupStart = 1;
                }
            }

            displayPagination(callback) {
                // callback 내부에서 호출된 함수
                document.getElementById('pagination').innerHTML = this.displayNavigation();
                for (
                    let i = this.currentPageGroupStart;
                    i < this.currentPageGroupStart + this.pagesPerPage &&
                    i <= this.getTotalPages();
                    i++
                ) {
                    document.getElementById(`page${i}`).addEventListener('click', evt => {
                        this.setCurrentPage(i);
                        // 요청 페이지 처리
                        callback();
                        this.displayPagination(callback);
                    });
                }
                if (document.getElementById('first')) {
                    document.getElementById('first').addEventListener('click', evt => {
                        this.setCurrentPage(1);
                        this.currentPageGroupStart = 1;
                        callback();
                        this.displayPagination(callback);
                    });
                }
                if (document.getElementById('prev')) {
                    document.getElementById('prev').addEventListener('click', evt => {
                        if (this.currentPageGroupStart > 1) {
                            this.setPrevPageGroup();
                            this.setCurrentPage(this.currentPageGroupStart + this.recordsPerPage - 1);
                            callback();
                            this.displayPagination(callback);
                        }
                    });
                }
                if (document.getElementById('next')) {
                    document.getElementById('next').addEventListener('click', evt => {
                        if (
                            this.currentPageGroupStart + this.pagesPerPage - 1 <
                            this.getTotalPages()
                        ) {
                            this.setNextPageGroup();
                            this.setCurrentPage(this.currentPageGroupStart);
                            callback();
                            this.displayPagination(callback);
                        }
                    });
                }
                if (document.getElementById('last')) {
                    document.getElementById('last').addEventListener('click', evt => {
                        const totalPages = this.getTotalPages();
                        this.currentPageGroupStart =
                            totalPages - (totalPages % this.pagesPerPage) + 1;
                        this.setCurrentPage(totalPages);
                        callback();
                        this.displayPagination(callback);
                    });
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            // 총 레코드 건수
            const totalCnt = window.totalCnt || 0;
            const cpgs = window.cpgs || 1;
            const cp = window.cp || 1;

            // 페이징 객체 생성
            const pagination = new Pagination(10, 10); // 한 페이지에 보여줄 레코드 건수, 한 페이지에 보여줄 페이지 수

            pagination.setCurrentPageGroupStart(cpgs); // 페이지 그룹 시작 번호
            pagination.setCurrentPage(cp); // 현재 페이지
            pagination.setTotalRecords(totalCnt); // 총 레코드 건수
            pagination.displayPagination(nextPage);

            function nextPage() {
                const reqPage = pagination.currentPage; // 요청 페이지
                const reqCnt = pagination.recordsPerPage; // 페이지당 레코드 수

                const cpgs = pagination.currentPageGroupStart; // 페이지 그룹 시작 번호
                const cp = pagination.currentPage; // 현재 페이지

                location.href = `/products?reqPage=${reqPage}&reqCnt=${reqCnt}&cpgs=${cpgs}&cp=${cp}`;
            }

            const $rows = document.getElementById('rows');
            if ($rows) {
                $rows.addEventListener('click', evt => {
                    if (evt.target.tagName === 'INPUT' && evt.target.getAttribute('type') === 'checkbox') {
                        return;
                    }

                    if (evt.target.tagName === 'TD' && evt.target.classList.contains('chk')) {
                        return;
                    }

                    const $row = evt.target.closest('.row');
                    const productId = $row.dataset.productId;
                    location.href = `/products/${productId}/detail`; // GET http://localhost:9080/상품번호/detail
                });
            }

            const frm = document.getElementById('frm');
            if (frm) {
                frm.addEventListener('submit', evt => {
                    evt.preventDefault();
                    if (!window.confirm('삭제하시겠습니까?')) return;

                    const selectedBbsIds = Array.from(document.querySelectorAll('#rows input[type=checkbox]:checked'))
                        .map(checkbox => checkbox.value);

                    fetch('/manager/comBbs', {
                        method: 'PATCH',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(selectedBbsIds)
                    })
                    .then(response => {
                        if (response.ok) {
                            alert('삭제 성공');
                            location.reload(); // 페이지를 새로고침하여 변경사항 반영
                        } else {
                            alert('삭제 실패');
                        }
                    })
                    .catch(error => {
                        console.error('삭제 오류:', error);
                        alert('삭제 오류가 발생했습니다.');
                    });
                });
            }

            const $selectAll = document.getElementById('selectAll');
            if ($selectAll) {
                $selectAll.addEventListener('click', () => {
                    const $inputs = Array.from(document.querySelectorAll('#rows input[type=checkbox]'));
                    const isSomeChecked = $inputs.some(input => input.checked);
                    $inputs.forEach(input => input.checked = !isSomeChecked);
                });
            }
        });
    </script>
</head>
<body>
<h1>검색 결과</h1>
<form th:action="@{/manager/searchBbs}" method="get" onsubmit="handleSearch(event)">
    <select name="searchType">
        <option value="all" selected> 전체</option>
        <option value="title">제목</option>
        <option value="mntnName">산 이름</option>
        <option value="nickname">작성자</option>
    </select>
    <input type="text" name="keyword" placeholder="검색어" />
    <button type="submit">검색</button>
</form>

<form id="frm" th:action="@{/manager/comBbs}" method="POST">
    <div>
        <table>
            <thead>
            <tr>
                <th><input type="checkbox" id="selectAll" /></th>
                <th>닉네임</th>
                <th>제목</th>
                <th>내용</th>
                <th>조회수</th>
                <th>평점</th>
                <th>작성일</th>
                <th>수정일</th>
                <th>산 이름</th>
                <th>글 상태</th>
            </tr>
            </thead>
            <tbody id="rows" class="rows">
            <tr class="row" th:each="bbs : ${list}" th:data-product-id="${bbs.bbsId}">
                <td class="chk"><input type="checkbox" name="bbsIds" th:value="${bbs.bbsId}"/></td>
                <td th:text="${bbs.nickname}"></td>
                <td th:text="${bbs.title}"></td>
                <td th:text="${bbs.bcontent}"></td>
                <td th:text="${bbs.hit}"></td>
                <td th:text="${bbs.staring}"></td>
                <td th:text="${bbs.cdate}"></td>
                <td th:text="${bbs.udate}"></td>
                <td th:text="${bbs.mntnNm}"></td>
                <td th:text="${bbs.status}"></td>
            </tr>
            </tbody>
        </table>
    </div>
    <div>
        <button type="submit" id="delBtn">삭제</button>
    </div>
</form>

<!-- 페이지네이션을 표시할 요소 -->
<div id="pagination"></div>

<h3><a href="http://localhost:9090/manager/comBbs">신고글</a></h3>
</body>
</html>
